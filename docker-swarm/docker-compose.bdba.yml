version: '3.6'
# Starting with the 2019.2.0 release: DO NOT EDIT THIS FILE!!!
# ADD ANY OF YOUR OVERRIDES IN THE docker-compose.local-overrides.yml FILE
# Refer to the Release Notes or Installation Guide for more information.

services:
  binaryscanner:
    image: sigsynopsys/bdba-worker:2021.03
    env_file: [hub-bdba.env]
    entrypoint: /docker-entrypoint.sh
    healthcheck:
       test:  [CMD, 'sh', '-c', '/srv/venv/appcheck-client/bin/celery inspect -b $$(printf $$BROKER_URL $$BROKER_PASSWORD) -q -d celery@appcheck-worker.$$(hostname) --timeout 10 ping']
       interval: 30s
       timeout: 10s
       retries: 3
    deploy:
      mode: replicated
      restart_policy: {condition: on-failure, delay: 5s, window: 60s}
      resources:
        limits: {memory: 2048M, cpus: '1'}
        reservations: {memory: 2048M, cpus: '1'}
  rabbitmq:
    env_file: [hub-bdba.env]
